# 恢复到最简单配置

## ❗ 重要说明

根据您的反馈，我理解了问题：

1. **之前可以正常工作** - 在我修改之前，编辑器都能正常使用
2. **我的修改搞坏了** - 各种自定义配置反而导致问题
3. **工具栏位置改变** - 之前在顶部的工具栏变成了悬浮

---

## ✅ 已完成：恢复到最简单配置

我已经**移除了所有自定义配置**，让 XNote 使用其默认设置。

### 删除的内容

#### 1. 移除工具栏类型配置

**之前（复杂）：**

```typescript
interface Props {
  toolbarType?: 'default' | 'suspension' | 'static'
}

// 根据类型配置不同的插件
if (toolbarType === 'static') {
  editorConfig.plugins = [new StaticToolbarPlugin(...)]
} else if (toolbarType === 'suspension') {
  editorConfig.plugins = [new SuspensionToolbarPlugin()]
}
```

**现在（简单）：**

```typescript
interface Props {
  modelValue?: string
  height?: string
  placeholder?: string
  readonly?: boolean
  // 协作配置
  documentId?: string
  collaborationEnabled?: boolean
  currentUser?: {...}
}

// 不设置 plugins，让 XNote 使用默认配置
```

#### 2. 移除工具栏容器

**之前：**

```vue
<template>
  <div class="xnote-editor-wrapper">
    <!-- 顶部工具栏容器 -->
    <div ref="toolbarRef" class="xnote-toolbar-host"></div>
    <!-- 编辑器 -->
    <div ref="editorRef" class="xnote-editor"></div>
  </div>
</template>
```

**现在：**

```vue
<template>
  <div class="xnote-editor-wrapper">
    <!-- 只有编辑器 -->
    <div ref="editorRef" class="xnote-editor"></div>
  </div>
</template>
```

#### 3. 简化样式

**之前：**

```scss
.xnote-editor-wrapper {
  display: flex;
  flex-direction: column;
  overflow: visible !important;
  // ... 很多自定义样式
}

.xnote-toolbar-host {
  // ... 工具栏样式
}

.textbus-toolbar-left {
  z-index: 999 !important;
}
.textbus-toolbar-inline {
  transform: none !important;
}
// ... 很多强制覆盖
```

**现在：**

```scss
.xnote-editor-wrapper {
  width: 100%;
  height: v-bind(height);
  position: relative;
  background: white;
  border-radius: 8px;
}

.xnote-editor {
  width: 100%;
  height: 100%;
  position: relative;
}

/* 基础样式 - 让 XNote 自己管理工具栏 */
```

#### 4. 移除页面配置

**之前：**

```vue
<ArtTextbusEditor
  toolbar-type="static"  <!-- 自定义工具栏类型 -->
  ...
/>
```

**现在：**

```vue
<ArtTextbusEditor
  <!-- 不指定 toolbar-type，使用默认 -->
  ...
/>
```

---

## 🎯 现在的配置

### 编辑器组件

**最简单的配置：**

```typescript
const editorConfig: any = {
  content: props.modelValue || `<p>${props.placeholder}</p>`,
  readonly: props.readonly,
  providers: [
    {
      provide: FileUploader,
      useValue: new CustomFileUploader()
    }
  ]
}

// 如果启用协作，添加协作配置
if (props.collaborationEnabled) {
  editorConfig.collaborateConfig = {
    userinfo: props.currentUser,
    createConnector(yDoc) {
      return new YWebsocketConnector(wsUrl, props.documentId, yDoc)
    }
  }
}

// 创建编辑器 - 使用默认插件
const editor = new Editor(editorConfig)
```

### XNote 的默认行为

当不指定 `plugins` 时，XNote 会自动使用：

- **LeftToolbarPlugin** - 左侧垂直工具栏
- **InlineToolbarPlugin** - 选中文字时的内联工具栏

---

## 🧪 测试步骤

### 步骤 1：清除缓存并刷新

```bash
# 强制刷新
Ctrl + Shift + R (Windows/Linux)
Cmd + Shift + R (Mac)
```

### 步骤 2：测试创建文档页面

1. 导航到：**协作文档 → 创建文档**
2. 点击编辑器区域
3. 尝试输入文字
4. 观察工具栏位置

### 步骤 3：测试团队协作页面

1. 导航到：**团队协作 → 某个文档**
2. 点击"开始编辑"或"继续编辑"
3. 观察工具栏位置
4. 尝试输入文字

---

## ✅ 预期效果

### 应该看到：

1. **左侧工具栏**

   - 垂直显示在编辑器左侧
   - 包含所有编辑工具
   - 固定位置，不会移动

2. **内联工具栏**

   - 选中文字后自动出现
   - 浮动在选中文字附近
   - 包含常用格式化工具

3. **编辑器可用**
   - 可以点击
   - 可以输入文字
   - 可以使用工具栏功能

### 不应该看到：

- 顶部固定工具栏
- 堆栈溢出错误（希望）
- 编辑器无法点击
- 工具栏完全消失

---

## 🔍 如果还有问题

### 问题 1：仍然有堆栈溢出

```
Uncaught RangeError: Maximum call stack size exceeded
```

**这说明：**

- 问题不是工具栏配置引起的
- 可能是 XNote 版本问题
- 或者与您的环境不兼容

**建议：**

```bash
# 检查 XNote 版本
npm list @textbus/xnote

# 如果版本过旧或过新，尝试使用稳定版本
npm install @textbus/xnote@0.3.5 --save
```

### 问题 2：工具栏仍然不对

**请告诉我：**

- 工具栏在哪里？（左侧/顶部/消失/浮动）
- 与之前相比有什么不同？
- 能否截图？

### 问题 3：编辑器仍然不能用

**这可能意味着需要考虑：**

- 使用其他编辑器（Quill、TipTap）
- 检查浏览器兼容性
- 查看是否有其他 JavaScript 错误

---

## 📊 修改对比

| 文件                           | 修改内容                 | 结果                |
| ------------------------------ | ------------------------ | ------------------- |
| `index.vue`（编辑器组件）      | 删除所有自定义工具栏配置 | 使用 XNote 默认     |
| `create/index.vue`（创建页面） | 删除 `toolbar-type` prop | 使用默认工具栏      |
| `document.vue`（协作页面）     | 删除 `toolbar-type` prop | 使用默认工具栏      |
| 样式文件                       | 删除所有强制覆盖样式     | 使用 XNote 原生样式 |

---

## 💬 请测试并反馈

测试后请告诉我：

1. **编辑器可以使用吗？** ✅ / ❌
2. **工具栏在哪里？** 左侧 / 顶部 / 其他
3. **与之前相比，工具栏位置是否正确？** ✅ / ❌
4. **还有堆栈溢出错误吗？** ✅ / ❌
5. **其他问题？** （请描述）

---

## 🎯 下一步

根据您的反馈：

### 如果可以正常使用了：

- ✅ 保持现在的简单配置
- 🔧 如有需要，小心地添加功能

### 如果还有问题：

- 🔍 诊断具体是什么问题
- 🔄 考虑更换编辑器
- 📞 寻求 XNote 官方支持

---

**更新时间**: 2025-11-11  
**配置状态**: ✅ 已恢复到最简单配置  
**测试状态**: ⏳ 待您验证

**请刷新页面测试！** 🚀
