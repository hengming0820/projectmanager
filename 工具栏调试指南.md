# 工具栏不可见 - 调试和修复指南

## 🔍 问题现象

- ✅ 编辑器白色区域正常显示
- ✅ 可以在编辑器中输入文字
- ❌ 看不到左侧的工具栏
- ❌ 选中文字时也没有浮动工具栏

## 🧪 立即测试（控制台命令）

### 步骤 1: 打开浏览器控制台

```
按 F12 或 Ctrl+Shift+I（Mac: Cmd+Option+I）
```

### 步骤 2: 检查工具栏元素

复制粘贴以下代码到控制台：

```javascript
// 查找所有可能的工具栏元素
const container = document.querySelector('.textbus-editor-container')
console.log('编辑器容器:', container)

if (container) {
  const allElements = container.querySelectorAll('*')
  console.log('容器内总元素数:', allElements.length)

  // 查找包含 toolbar 的元素
  const toolbarElements = Array.from(allElements).filter((el) => {
    const className = el.className
    return (
      className &&
      typeof className === 'string' &&
      (className.includes('toolbar') || className.includes('Toolbar'))
    )
  })

  console.log('找到的工具栏元素:', toolbarElements)
  console.log('工具栏数量:', toolbarElements.length)

  if (toolbarElements.length === 0) {
    console.error('❌ 未找到任何工具栏元素！')
    console.log('💡 这说明工具栏插件没有正确加载')
  } else {
    console.log('✅ 找到工具栏，检查样式...')
    toolbarElements.forEach((el, index) => {
      const styles = window.getComputedStyle(el)
      console.log(`工具栏 ${index + 1}:`, {
        className: el.className,
        display: styles.display,
        visibility: styles.visibility,
        opacity: styles.opacity,
        position: styles.position,
        zIndex: styles.zIndex,
        width: el.offsetWidth,
        height: el.offsetHeight
      })
    })
  }
}
```

### 步骤 3: 强制显示工具栏（如果找到了）

如果上面找到了工具栏，运行这个命令强制显示：

```javascript
// 强制显示所有工具栏
const toolbars = document.querySelectorAll('[class*="toolbar"], [class*="Toolbar"]')
console.log('准备强制显示', toolbars.length, '个工具栏元素')

toolbars.forEach((toolbar, index) => {
  // 强制样式
  toolbar.style.display = 'block'
  toolbar.style.visibility = 'visible'
  toolbar.style.opacity = '1'
  toolbar.style.position = 'absolute'
  toolbar.style.left = '0'
  toolbar.style.top = '0'
  toolbar.style.zIndex = '1000'
  toolbar.style.background = 'white'
  toolbar.style.border = '1px solid #e5e7eb'
  toolbar.style.padding = '8px'
  toolbar.style.width = 'auto'

  console.log(`✅ 已强制显示工具栏 ${index + 1}:`, toolbar.className)
})

console.log('✅ 完成！检查页面是否出现工具栏')
```

## 📊 根据结果判断

### 情况 A: 找到了工具栏元素（数量 > 0）

**说明：** 工具栏存在，但是被隐藏了

**解决方案：**

1. 运行上面的"强制显示"脚本
2. 如果工具栏出现了，说明是 CSS 样式问题
3. 刷新页面，新的 CSS 样式应该已经生效

**如果刷新后还是不可见：**

- 清除浏览器缓存（Ctrl+Shift+Delete）
- 强制刷新（Ctrl+Shift+R）

### 情况 B: 没有找到工具栏元素（数量 = 0）

**说明：** 工具栏插件没有加载

**原因：** XNote 编辑器的默认插件可能没有正确初始化

**临时解决方案：** 使用浮动工具栏

在控制台运行：

```javascript
// 创建简易工具栏
const toolbar = document.createElement('div')
toolbar.style.cssText = `
  position: fixed;
  left: 10px;
  top: 100px;
  background: white;
  border: 1px solid #ddd;
  padding: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  z-index: 9999;
  border-radius: 4px;
`

toolbar.innerHTML = `
  <div style="font-weight: bold; margin-bottom: 8px;">快捷工具</div>
  <button onclick="document.execCommand('bold')" style="margin: 2px; padding: 5px 10px;">粗体</button>
  <button onclick="document.execCommand('italic')" style="margin: 2px; padding: 5px 10px;">斜体</button>
  <button onclick="document.execCommand('underline')" style="margin: 2px; padding: 5px 10px;">下划线</button>
  <br>
  <button onclick="document.execCommand('insertUnorderedList')" style="margin: 2px; padding: 5px 10px;">列表</button>
  <button onclick="document.execCommand('undo')" style="margin: 2px; padding: 5px 10px;">撤销</button>
  <button onclick="document.execCommand('redo')" style="margin: 2px; padding: 5px 10px;">重做</button>
`

document.body.appendChild(toolbar)
console.log('✅ 已创建临时工具栏')
```

## 🔧 永久修复方案

### 修复 1: 已添加强制显示 CSS

我已经在 `src/components/core/forms/art-textbus-editor/index.vue` 中添加了强制显示的 CSS：

```scss
.textbus-editor-container [class*='toolbar'],
.textbus-editor-container [class*='Toolbar'] {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  // ... 更多样式
}
```

### 修复 2: 已添加 JavaScript 强制显示

编辑器初始化后会自动运行工具栏检测和强制显示代码。

### 修复 3: 检查插件配置

如果上述方法都不行，需要修改编辑器配置，明确指定工具栏插件。

## 📝 刷新页面后检查

刷新页面后，在控制台应该看到：

```
✅ [TextBus] 编辑器实例已创建
🔍 [TextBus] 检查工具栏元素...
🔍 [TextBus] 找到的工具栏元素: X [...]
✅ [TextBus] 已强制显示工具栏: ...
```

**如果还是看不到工具栏，请截图控制台日志并提供。**

## 🎯 快速操作清单

现在请按以下顺序操作：

1. ✅ 刷新页面（Ctrl+Shift+R）
2. ✅ 打开控制台（F12）
3. ✅ 查看是否有 "找到的工具栏元素" 的日志
4. ✅ 如果工具栏元素数量 > 0，说明已经修复
5. ✅ 如果工具栏元素数量 = 0，运行上面的检测脚本

## 💡 选中文本测试

即使左侧工具栏不可见，浮动工具栏应该可以工作：

1. 在编辑器中输入一些文字
2. 用鼠标选中文字
3. 应该弹出浮动工具栏（包含粗体、斜体等按钮）

**如果浮动工具栏也不出现：**

- 说明工具栏插件完全没有加载
- 需要修改编辑器配置

## 🆘 如果所有方法都不行

请提供以下信息：

1. **控制台日志截图**

   - 特别是包含 `[TextBus]` 的日志

2. **Elements 标签的 HTML 结构**

   - 找到 `.textbus-editor-container`
   - 展开查看子元素
   - 截图整个结构

3. **检测脚本的输出**
   - 运行步骤 2 的检测脚本
   - 复制完整的控制台输出

---

**预计解决时间：** 5-10 分钟  
**成功率：**

- 情况 A（工具栏存在但不可见）：95%
- 情况 B（工具栏未加载）：需要代码修改

请先刷新页面并运行检测脚本！🔍
