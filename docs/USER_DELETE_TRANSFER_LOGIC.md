# ç”¨æˆ·åˆ é™¤ - æ•°æ®è½¬ç§»æœºåˆ¶

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

åˆ é™¤ç”¨æˆ·æ—¶ï¼Œç³»ç»Ÿä¼š**è‡ªåŠ¨å°†åˆ›å»ºçš„æ•°æ®è½¬ç§»ç»™ç®¡ç†å‘˜**ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚

---

## ğŸ“¦ è‡ªåŠ¨è½¬ç§»çš„æ•°æ®

| æ•°æ®ç±»å‹     | å­—æ®µ                             | è½¬ç§»å¯¹è±¡   | ç»“æœ                   |
| ------------ | -------------------------------- | ---------- | ---------------------- |
| åˆ›å»ºçš„é¡¹ç›®   | `Project.created_by`             | ç³»ç»Ÿç®¡ç†å‘˜ | é¡¹ç›®ä¿ç•™ï¼Œåˆ›å»ºè€…å˜æ›´   |
| åˆ›å»ºçš„ä»»åŠ¡   | `Task.created_by`                | ç³»ç»Ÿç®¡ç†å‘˜ | ä»»åŠ¡ä¿ç•™ï¼Œåˆ›å»ºè€…å˜æ›´   |
| å‘å¸ƒçš„æ–‡ç«    | `Article.author_id`              | ç³»ç»Ÿç®¡ç†å‘˜ | æ–‡ç« ä¿ç•™ï¼Œä½œè€…å˜æ›´     |
| åˆ›å»ºçš„å·¥ä½œå‘¨ | `WorkWeek.created_by`            | ç³»ç»Ÿç®¡ç†å‘˜ | å·¥ä½œå‘¨ä¿ç•™ï¼Œåˆ›å»ºè€…å˜æ›´ |
| åä½œæ–‡æ¡£     | `CollaborationDocument.owner_id` | ç³»ç»Ÿç®¡ç†å‘˜ | æ–‡æ¡£ä¿ç•™ï¼Œæ‰€æœ‰è€…å˜æ›´   |
| ä»»åŠ¡é™„ä»¶     | `TaskAttachment.uploaded_by`     | ç³»ç»Ÿç®¡ç†å‘˜ | é™„ä»¶ä¿ç•™ï¼Œä¸Šä¼ è€…å˜æ›´   |
| æ–‡ç« ç¼–è¾‘å†å² | `ArticleEditHistory.editor_id`   | ç³»ç»Ÿç®¡ç†å‘˜ | å†å²ä¿ç•™ï¼Œç¼–è¾‘è€…å˜æ›´   |

---

## ğŸ”„ è½¬ç§»æµç¨‹

### 1. è‡ªåŠ¨é€‰æ‹©ç®¡ç†å‘˜

ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ç®¡ç†å‘˜ï¼š

```sql
SELECT * FROM users
WHERE role = 'admin'
  AND status = 'active'
  AND id != 'è¢«åˆ é™¤ç”¨æˆ·ID'
LIMIT 1
```

**é€‰æ‹©è§„åˆ™**ï¼š

- âœ… è§’è‰²ä¸º `admin`
- âœ… çŠ¶æ€ä¸º `active`ï¼ˆæ´»è·ƒï¼‰
- âœ… ä¸æ˜¯è¢«åˆ é™¤çš„ç”¨æˆ·æœ¬èº«

### 2. æ‰¹é‡è½¬ç§»æ•°æ®

```python
# 1. è½¬ç§»é¡¹ç›®
UPDATE projects
SET created_by = 'admin_id'
WHERE created_by = 'user_id'

# 2. è½¬ç§»ä»»åŠ¡
UPDATE tasks
SET created_by = 'admin_id',
    created_by_name = 'admin_name'
WHERE created_by = 'user_id'

# 3. è½¬ç§»æ–‡ç« 
UPDATE articles
SET author_id = 'admin_id',
    author_name = 'admin_name'
WHERE author_id = 'user_id'

# 4. è½¬ç§»å·¥ä½œå‘¨
UPDATE work_weeks
SET created_by = 'admin_id'
WHERE created_by = 'user_id'

# 5. è½¬ç§»åä½œæ–‡æ¡£
UPDATE collaboration_documents
SET owner_id = 'admin_id',
    owner_name = 'admin_name'
WHERE owner_id = 'user_id'

# 6. è½¬ç§»ä»»åŠ¡é™„ä»¶
UPDATE task_attachments
SET uploaded_by = 'admin_id'
WHERE uploaded_by = 'user_id'

# 7. è½¬ç§»æ–‡ç« ç¼–è¾‘å†å²
UPDATE article_edit_history
SET editor_id = 'admin_id',
    editor_name = 'admin_name'
WHERE editor_id = 'user_id'
```

### 3. åˆ é™¤ç”¨æˆ·

æ•°æ®è½¬ç§»å®Œæˆåï¼Œåˆ é™¤ç”¨æˆ·è®°å½•ã€‚

---

## ğŸ’¡ å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šåˆ é™¤æœ‰åˆ›å»ºæ•°æ®çš„ç”¨æˆ·

**åœºæ™¯**ï¼š

```
ç”¨æˆ·ï¼šå¼ ä¸‰ï¼ˆé¡¹ç›®ç»ç†ï¼Œç¦»èŒï¼‰
  â”œâ”€ åˆ›å»ºçš„é¡¹ç›®: 5 ä¸ª
  â”œâ”€ åˆ›å»ºçš„ä»»åŠ¡: 50 ä¸ª
  â”œâ”€ å‘å¸ƒçš„æ–‡ç« : 10 ç¯‡
  â”œâ”€ ä»»åŠ¡é™„ä»¶: 20 ä¸ª
  â””â”€ æ–‡ç« ç¼–è¾‘å†å²: 30 æ¡
```

**åˆ é™¤å‰**ï¼š

```
ç”¨æˆ·ç¡®è®¤åˆ é™¤ â†’ ç³»ç»ŸæŸ¥æ‰¾ç®¡ç†å‘˜
```

**ç³»ç»Ÿå¤„ç†**ï¼š

```
æ‰¾åˆ°ç®¡ç†å‘˜ï¼šadminï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰

è‡ªåŠ¨è½¬ç§»ï¼š
  â”œâ”€ 5 ä¸ªé¡¹ç›® â†’ created_by = admin
  â”œâ”€ 50 ä¸ªä»»åŠ¡ â†’ created_by = admin
  â”œâ”€ 10 ç¯‡æ–‡ç«  â†’ author_id = admin
  â”œâ”€ 20 ä¸ªä»»åŠ¡é™„ä»¶ â†’ uploaded_by = admin
  â””â”€ 30 æ¡æ–‡ç« ç¼–è¾‘å†å² â†’ editor_id = admin
```

**åˆ é™¤å**ï¼š

```
âœ… ç”¨æˆ·"å¼ ä¸‰"å·²åˆ é™¤
âœ… 5 ä¸ªé¡¹ç›®ä»ç„¶å­˜åœ¨ï¼ˆåˆ›å»ºè€…ï¼šadminï¼‰
âœ… 50 ä¸ªä»»åŠ¡ä»ç„¶å­˜åœ¨ï¼ˆåˆ›å»ºè€…ï¼šadminï¼‰
âœ… 10 ç¯‡æ–‡ç« ä»ç„¶å­˜åœ¨ï¼ˆä½œè€…ï¼šadminï¼‰
âœ… 20 ä¸ªä»»åŠ¡é™„ä»¶ä»ç„¶å­˜åœ¨ï¼ˆä¸Šä¼ è€…ï¼šadminï¼‰
âœ… 30 æ¡æ–‡ç« ç¼–è¾‘å†å²ä»ç„¶å­˜åœ¨ï¼ˆç¼–è¾‘è€…ï¼šadminï¼‰
âœ… æ•°æ®å®Œæ•´æ€§ä¿è¯
âœ… é¡¹ç›®ã€ä»»åŠ¡ã€æ–‡ç« ã€é™„ä»¶ã€å†å²è®°å½•æ­£å¸¸å¯ç”¨
```

**æ—¥å¿—è¾“å‡º**ï¼š

```
[INFO] ä½¿ç”¨ç®¡ç†å‘˜ admin (user1) æ¥ç®¡æ•°æ®
[INFO] å°†è½¬ç§»ä»¥ä¸‹æ•°æ®ç»™ç®¡ç†å‘˜: ['åˆ›å»ºçš„é¡¹ç›®: 5 ä¸ª', 'åˆ›å»ºçš„ä»»åŠ¡: 50 ä¸ª', 'å‘å¸ƒçš„æ–‡ç« : 10 ç¯‡', 'ä»»åŠ¡é™„ä»¶: 20 ä¸ª', 'æ–‡ç« ç¼–è¾‘å†å²: 30 æ¡']
[INFO] âœ… å·²å°† 5 ä¸ªé¡¹ç›®è½¬ç§»ç»™ç®¡ç†å‘˜ admin
[INFO] âœ… å·²å°† 50 ä¸ªä»»åŠ¡è½¬ç§»ç»™ç®¡ç†å‘˜ admin
[INFO] âœ… å·²å°† 10 ç¯‡æ–‡ç« è½¬ç§»ç»™ç®¡ç†å‘˜ admin
[INFO] âœ… å·²å°† 20 ä¸ªä»»åŠ¡é™„ä»¶è½¬ç§»ç»™ç®¡ç†å‘˜ admin
[INFO] âœ… å·²å°† 30 æ¡æ–‡ç« ç¼–è¾‘å†å²è½¬ç§»ç»™ç®¡ç†å‘˜ admin
[INFO] âœ… ç”¨æˆ·åˆ é™¤æˆåŠŸ: user_zhang (å¼ ä¸‰)
```

### æ¡ˆä¾‹ 2ï¼šæ²¡æœ‰æ´»è·ƒç®¡ç†å‘˜

**åœºæ™¯**ï¼š

```
ç³»ç»Ÿä¸­æ‰€æœ‰ç®¡ç†å‘˜éƒ½è¢«åœç”¨
å°è¯•åˆ é™¤ç”¨æˆ·
```

**ç³»ç»Ÿå“åº”**ï¼š

```
âŒ åˆ é™¤å¤±è´¥

é”™è¯¯ä¿¡æ¯ï¼š
ç³»ç»Ÿé”™è¯¯ï¼šæ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„ç®¡ç†å‘˜è´¦å·æ¥æ¥ç®¡æ•°æ®ï¼Œ
è¯·å…ˆç¡®ä¿ç³»ç»Ÿä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç®¡ç†å‘˜è´¦å·
```

**è§£å†³æ–¹æ³•**ï¼š

1. å¯ç”¨è‡³å°‘ä¸€ä¸ªç®¡ç†å‘˜è´¦å·
2. æˆ–è€…åˆ›å»ºæ–°çš„ç®¡ç†å‘˜è´¦å·
3. ç„¶åå†å°è¯•åˆ é™¤

---

## ğŸ¨ ç”¨æˆ·ç•Œé¢

### åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åˆ é™¤ç”¨æˆ·                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¡®å®šè¦åˆ é™¤ç”¨æˆ·ã€Œå¼ ä¸‰ã€å—ï¼Ÿ                  â”‚
â”‚                                            â”‚
â”‚ ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ä»¥ä¸‹å…³è”æ•°æ®ï¼š                â”‚
â”‚                                            â”‚
â”‚ ğŸ“¦ æ•°æ®è½¬ç§»ï¼ˆè½¬ç»™ç³»ç»Ÿç®¡ç†å‘˜ï¼‰ï¼š             â”‚
â”‚ â€¢ åˆ›å»ºçš„é¡¹ç›® â†’ è½¬ç§»ç»™ç®¡ç†å‘˜                â”‚
â”‚ â€¢ åˆ›å»ºçš„ä»»åŠ¡ â†’ è½¬ç§»ç»™ç®¡ç†å‘˜                â”‚
â”‚ â€¢ å‘å¸ƒçš„æ–‡ç«  â†’ è½¬ç§»ç»™ç®¡ç†å‘˜                â”‚
â”‚ â€¢ åˆ›å»ºçš„å·¥ä½œå‘¨ â†’ è½¬ç§»ç»™ç®¡ç†å‘˜              â”‚
â”‚ â€¢ åä½œæ–‡æ¡£ â†’ è½¬ç§»ç»™ç®¡ç†å‘˜                  â”‚
â”‚ â€¢ ä»»åŠ¡é™„ä»¶ â†’ è½¬ç§»ç»™ç®¡ç†å‘˜                  â”‚
â”‚ â€¢ æ–‡ç« ç¼–è¾‘å†å² â†’ è½¬ç§»ç»™ç®¡ç†å‘˜              â”‚
â”‚                                            â”‚
â”‚ ğŸ”„ ä»»åŠ¡å¤„ç†ï¼š                              â”‚
â”‚ â€¢ è¿›è¡Œä¸­çš„ä»»åŠ¡ â†’ è®¾ä¸ºæœªåˆ†é…                â”‚
â”‚ â€¢ å·²å®Œæˆçš„ä»»åŠ¡ â†’ ä¿ç•™ï¼ˆå†å²è®°å½•ï¼‰           â”‚
â”‚                                            â”‚
â”‚ ğŸ“Š æ•°æ®ä¿ç•™ï¼š                              â”‚
â”‚ â€¢ ç”¨æˆ·çš„ç»©æ•ˆç»Ÿè®¡ â†’ ä¿ç•™ï¼ˆå†å²è®°å½•ï¼‰         â”‚
â”‚                                            â”‚
â”‚ ğŸ—‘ï¸ æ•°æ®åˆ é™¤ï¼š                              â”‚
â”‚ â€¢ ç”¨æˆ·çš„å·¥ä½œæ—¥å¿— â†’ åˆ é™¤                     â”‚
â”‚ â€¢ æ–‡æ¡£åä½œå…³ç³» â†’ åˆ é™¤                      â”‚
â”‚                                            â”‚
â”‚ âš ï¸ æ³¨æ„ï¼š                                  â”‚
â”‚ â€¢ åˆ é™¤æ“ä½œä¸å¯æ¢å¤                          â”‚
â”‚ â€¢ åˆ›å»ºçš„æ•°æ®ä¼šè‡ªåŠ¨è½¬ç§»ï¼Œä¿è¯æ•°æ®å®Œæ•´æ€§      â”‚
â”‚ â€¢ å»ºè®®ä¼˜å…ˆä½¿ç”¨ã€Œåœç”¨ã€åŠŸèƒ½                  â”‚
â”‚                                            â”‚
â”‚         [ å–æ¶ˆ ]    [ ç¡®å®šåˆ é™¤ ]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ é™¤æˆåŠŸæç¤º

```
[SUCCESS] åˆ é™¤æˆåŠŸ

æ•°æ®è½¬ç§»ï¼š
âœ… å·²å°† 5 ä¸ªé¡¹ç›®è½¬ç§»ç»™ç®¡ç†å‘˜ admin
âœ… å·²å°† 50 ä¸ªä»»åŠ¡è½¬ç§»ç»™ç®¡ç†å‘˜ admin
âœ… å·²å°† 10 ç¯‡æ–‡ç« è½¬ç§»ç»™ç®¡ç†å‘˜ admin
âœ… å·²å°† 20 ä¸ªä»»åŠ¡é™„ä»¶è½¬ç§»ç»™ç®¡ç†å‘˜ admin
âœ… å·²å°† 30 æ¡æ–‡ç« ç¼–è¾‘å†å²è½¬ç§»ç»™ç®¡ç†å‘˜ admin

ä»»åŠ¡å¤„ç†ï¼š
âœ… å·²å°† 3 ä¸ªè¿›è¡Œä¸­çš„ä»»åŠ¡è®¾ä¸ºæœªåˆ†é…
â„¹ï¸  ä¿ç•™ 45 ä¸ªå·²å®Œæˆçš„ä»»åŠ¡ä½œä¸ºå†å²è®°å½•

æ•°æ®ä¿ç•™ï¼š
â„¹ï¸  ä¿ç•™ 12 æ¡ç»©æ•ˆç»Ÿè®¡è®°å½•ä½œä¸ºå†å²æ•°æ®

æ•°æ®åˆ é™¤ï¼š
âœ… å·²åˆ é™¤ 30 æ¡å·¥ä½œæ—¥å¿—
âœ… å·²åˆ é™¤ 5 æ¡æ–‡æ¡£åä½œå…³ç³»

âœ… ç”¨æˆ·åˆ é™¤æˆåŠŸ
```

---

## âœ… ä¼˜åŠ¿å¯¹æ¯”

### ä¼˜åŒ–å‰ï¼ˆé˜»æ­¢åˆ é™¤ï¼‰

```
âŒ ç”¨æˆ·æœ‰åˆ›å»ºæ•°æ® â†’ é˜»æ­¢åˆ é™¤
âŒ éœ€è¦æ‰‹åŠ¨è½¬ç§»æ•°æ®
âŒ æ“ä½œç¹ç
âŒ å®¹æ˜“å‡ºé”™
```

### ä¼˜åŒ–åï¼ˆè‡ªåŠ¨è½¬ç§»ï¼‰

```
âœ… è‡ªåŠ¨è½¬ç§»ç»™ç®¡ç†å‘˜
âœ… ä¸€é”®åˆ é™¤
âœ… æ•°æ®å®Œæ•´æ€§ä¿è¯
âœ… æ“ä½œç®€å•
âœ… ä¸ä¼šå‡ºé”™
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç®¡ç†å‘˜è´¦å·è¦æ±‚

ç³»ç»Ÿä¸­**å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç®¡ç†å‘˜è´¦å·**ï¼š

- âœ… è§’è‰²ä¸º `admin`
- âœ… çŠ¶æ€ä¸º `active`
- âœ… ä¸æ˜¯è¢«åˆ é™¤çš„ç”¨æˆ·

å¦‚æœæ²¡æœ‰ï¼Œåˆ é™¤æ“ä½œä¼šå¤±è´¥ã€‚

### 2. æ•°æ®æ‰€æœ‰æƒå˜æ›´

è½¬ç§»åï¼Œæ•°æ®çš„åˆ›å»ºè€…/ä½œè€…ä¼šå˜æ›´ï¼š

- é¡¹ç›®åˆ›å»ºè€…ï¼šåŸç”¨æˆ· â†’ ç®¡ç†å‘˜
- ä»»åŠ¡åˆ›å»ºè€…ï¼šåŸç”¨æˆ· â†’ ç®¡ç†å‘˜
- æ–‡ç« ä½œè€…ï¼šåŸç”¨æˆ· â†’ ç®¡ç†å‘˜

**ä½†æ˜¯**ï¼š

- âœ… æ•°æ®æœ¬èº«ä¸ä¼šä¸¢å¤±
- âœ… æ•°æ®å†…å®¹ä¸ä¼šæ”¹å˜
- âœ… æ•°æ®ä»ç„¶å¯ç”¨
- âœ… å¯ä»¥è¿½æº¯å†å²

### 2.1 ç»©æ•ˆæ•°æ®ä¿ç•™è¯´æ˜

**ä¸ºä»€ä¹ˆä¿ç•™ç»©æ•ˆæ•°æ®ï¼Ÿ**

- âœ… **å†å²è¿½æº¯**ï¼šåæ˜ ç”¨æˆ·è¿‡å»çš„å·¥ä½œè¡¨ç°
- âœ… **å›¢é˜Ÿç»Ÿè®¡**ï¼šå›¢é˜Ÿç»©æ•ˆæŠ¥è¡¨éœ€è¦å®Œæ•´çš„å†å²æ•°æ®
- âœ… **å®¡è®¡éœ€æ±‚**ï¼šç¬¦åˆHRç®¡ç†çš„å®¡è®¡è¦æ±‚
- âœ… **åªè¯»æ•°æ®**ï¼šç»©æ•ˆæ•°æ®æ˜¯å†å²è®°å½•ï¼Œä¸æ¶‰åŠæ•æ„Ÿæ“ä½œ

**ä¿ç•™ç­–ç•¥**ï¼š

- ç»©æ•ˆæ•°æ® (`PerformanceStats`) ä¿ç•™åœ¨æ•°æ®åº“ä¸­
- `user_id` ä»ç„¶æŒ‡å‘åŸç”¨æˆ·IDï¼ˆå³ä½¿ç”¨æˆ·å·²åˆ é™¤ï¼‰
- å¯é€šè¿‡ `user_name` å­—æ®µè¯†åˆ«ç”¨æˆ·
- ç±»ä¼¼äº"å·²å®Œæˆçš„ä»»åŠ¡"çš„å¤„ç†æ–¹å¼

### 3. å®¡è®¡è¿½æº¯

å»ºè®®åœ¨åº”ç”¨å±‚è®°å½•æ•°æ®è½¬ç§»å†å²ï¼š

```python
# åˆ é™¤æ—¥å¿—
{
    "action": "user_delete",
    "user_id": "user_zhang",
    "username": "å¼ ä¸‰",
    "transferred_to": "admin",
    "transferred_data": {
        "projects": 5,
        "tasks": 50,
        "articles": 10
    },
    "timestamp": "2025-10-16 10:00:00"
}
```

### 4. æ€§èƒ½è€ƒè™‘

å¦‚æœç”¨æˆ·åˆ›å»ºäº†å¤§é‡æ•°æ®ï¼Œè½¬ç§»æ“ä½œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼š

- æ•°æ®é‡å°ï¼ˆ< 1000æ¡ï¼‰ï¼šå‡ ç§’é’Ÿ
- æ•°æ®é‡ä¸­ï¼ˆ< 10000æ¡ï¼‰ï¼šå‡ åç§’
- æ•°æ®é‡å¤§ï¼ˆ> 10000æ¡ï¼‰ï¼šå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿ

å»ºè®®ï¼š

- âœ… åœ¨æ“ä½œå®Œæˆå‰æ˜¾ç¤ºåŠ è½½æç¤º
- âœ… ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿åŸå­æ€§
- âœ… è®°å½•è¯¦ç»†æ—¥å¿—ä¾¿äºæ’æŸ¥

---

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯ä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰

```python
@router.delete("/{user_id}")
def delete_user(user_id: str, db: Session = Depends(get_db)):
    # 1. æŸ¥æ‰¾ç³»ç»Ÿç®¡ç†å‘˜
    system_admin = db.query(User).filter(
        User.role == "admin",
        User.status == "active",
        User.id != user_id
    ).first()

    if not system_admin:
        raise HTTPException(500, "æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„ç®¡ç†å‘˜è´¦å·")

    # 2. è½¬ç§»åˆ›å»ºçš„æ•°æ®
    # è½¬ç§»é¡¹ç›®
    db.query(Project).filter(
        Project.created_by == user_id
    ).update({"created_by": system_admin.id})

    # è½¬ç§»ä»»åŠ¡
    db.query(Task).filter(
        Task.created_by == user_id
    ).update({
        "created_by": system_admin.id,
        "created_by_name": system_admin.real_name
    })

    # è½¬ç§»æ–‡ç« 
    db.query(Article).filter(
        Article.author_id == user_id
    ).update({
        "author_id": system_admin.id,
        "author_name": system_admin.real_name
    })

    # è½¬ç§»ä»»åŠ¡é™„ä»¶
    db.query(TaskAttachment).filter(
        TaskAttachment.uploaded_by == user_id
    ).update({
        "uploaded_by": system_admin.id
    })

    # è½¬ç§»æ–‡ç« ç¼–è¾‘å†å²
    db.query(ArticleEditHistory).filter(
        ArticleEditHistory.editor_id == user_id
    ).update({
        "editor_id": system_admin.id,
        "editor_name": system_admin.real_name
    })

    # ... å…¶ä»–è½¬ç§»æ“ä½œ ...

    # åˆ é™¤å·¥ä½œæ—¥å¿—
    db.query(WorkLogEntry).filter(
        WorkLogEntry.user_id == user_id
    ).delete()

    # ä¿ç•™ç»©æ•ˆç»Ÿè®¡ï¼ˆä½œä¸ºå†å²è®°å½•ï¼‰
    # ç»©æ•ˆæ•°æ®ä¸åˆ é™¤ï¼Œä¿ç•™ç”¨äºå†å²è¿½æº¯å’Œå›¢é˜Ÿç»Ÿè®¡

    # åˆ é™¤æ–‡æ¡£åä½œå…³ç³»
    db.query(DocumentCollaborator).filter(
        DocumentCollaborator.user_id == user_id
    ).delete()

    # 3. åˆ é™¤ç”¨æˆ·
    db.delete(user)
    db.commit()

    return {"message": "åˆ é™¤æˆåŠŸ"}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/USER_DELETE_LOGIC.md` - å®Œæ•´åˆ é™¤é€»è¾‘
- `docs/USER_DELETE_TASK_STATUS.md` - ä»»åŠ¡çŠ¶æ€å¤„ç†
- `backend/app/api/users.py` - å®ç°ä»£ç 

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. **ğŸ”„ è‡ªåŠ¨åŒ–å¤„ç†**

   - æ— éœ€æ‰‹åŠ¨è½¬ç§»æ•°æ®
   - ä¸€é”®åˆ é™¤ï¼Œç®€å•é«˜æ•ˆ

2. **âœ… æ•°æ®å®Œæ•´æ€§**

   - æ‰€æœ‰æ•°æ®ä¿ç•™
   - æ‰€æœ‰æƒæ˜ç¡®
   - å¯è¿½æº¯å†å²

3. **ğŸ›¡ï¸ å®‰å…¨æ€§**

   - éœ€è¦æ´»è·ƒç®¡ç†å‘˜
   - äº‹åŠ¡ä¿è¯
   - æ—¥å¿—è®°å½•

4. **ğŸ‘¥ ç”¨æˆ·å‹å¥½**
   - æ¸…æ™°çš„æç¤º
   - è¯¦ç»†çš„åé¦ˆ
   - æ“ä½œç®€å•

### æœ€ä½³å®è·µ

è™½ç„¶ç°åœ¨å¯ä»¥ç›´æ¥åˆ é™¤æœ‰åˆ›å»ºæ•°æ®çš„ç”¨æˆ·ï¼Œä½†ä»ç„¶**å»ºè®®ä¼˜å…ˆä½¿ç”¨ã€Œåœç”¨ã€åŠŸèƒ½**ï¼š

- âœ… ä¿ç•™å®Œæ•´å†å²
- âœ… å¯ä»¥éšæ—¶æ¢å¤
- âœ… ç¬¦åˆå®¡è®¡è¦æ±‚
- âœ… æ›´å®‰å…¨å¯é 

---

**æœ€åæ›´æ–°**: 2025-10-16  
**ä½œè€…**: AI Assistant  
**ç‰ˆæœ¬**: v3.2ï¼ˆç»©æ•ˆæ•°æ®æ”¹ä¸ºä¿ç•™ï¼Œä½œä¸ºå†å²è®°å½•ï¼‰
