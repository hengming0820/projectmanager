# 快速测试新布局

## ✅ 已完成的改进

### 1. **布局反转**

- ✅ 左侧：设置面板（320px）+ 在线用户
- ✅ 右侧：编辑器（flex: 1，充足空间）

### 2. **悬浮工具栏**

- ✅ 使用 `SuspensionToolbarPlugin`
- ✅ 自动检测边缘，智能调整位置
- ✅ 不会被遮挡

### 3. **在线用户显示**

- ✅ 嵌入左侧设置面板
- ✅ 实时更新用户列表
- ✅ 显示用户头像、名称、在线状态

## 🚀 快速测试（3分钟）

### 步骤 1：启动 Yjs 服务器

```bash
cd yjs-collab-server
npm start
```

看到 `✅ Running` 即可。

### 步骤 2：刷新前端页面

按 `Ctrl + Shift + R` 强制刷新。

### 步骤 3：进入创建文档页面

导航：**协作文档 → 创建文档**

### 步骤 4：观察新布局

#### 左侧面板（320px）

```
┌─────────────────┐
│ 📋 文档设置      │
│ • 可见性        │
│ • 优先级        │
│                 │
│ 👥 协作成员      │
│                 │
│ 🏷️ 标签         │
│                 │
│ 📊 统计信息      │
│ • 标题字数      │
│ • 描述字数      │
│                 │
│ ────────────   │
│                 │
│ 👥 正在编辑 (1) │
│ 🟢 您的用户名   │
│   (我)          │
│                 │
└─────────────────┘
```

#### 右侧编辑器（充足空间）

```
┌──────────────────────────────────┐
│ 标题：___________________        │
│                                  │
│ 描述：___________________        │
│       ___________________        │
│                                  │
│ ─────────────────────────────   │
│                                  │
│ 这里是编辑器内容...              │
│                                  │
│ ✅ 空间充足                      │
│ ✅ 悬浮工具栏不会被遮挡           │
│                                  │
└──────────────────────────────────┘
```

### 步骤 5：测试悬浮工具栏

1. **在编辑器中输入一些文字**

   ```
   这是一段测试文本，用于测试悬浮工具栏。
   ```

2. **选中文字**

   - 鼠标拖动选中任意文本

3. **观察悬浮工具栏**

   ```
   选中文字后会自动出现：
   ┌──────────────────┐
   │ B I U 🎨 📎 🔗  │ ← 悬浮工具栏
   └──────────────────┘
   ```

4. **测试边缘情况**
   - 选中编辑器**顶部**的文字 → 工具栏应该在文字下方
   - 选中编辑器**左侧**的文字 → 工具栏应该完整显示
   - 选中编辑器**右侧**的文字 → 工具栏应该完整显示
   - 选中编辑器**底部**的文字 → 工具栏应该在文字上方

### 步骤 6：测试多用户协作

1. **打开隐身窗口**（或另一个浏览器）

2. **登录另一个账号**

3. **进入创建文档页面**

4. **观察左侧在线用户列表**

   ```
   👥 正在编辑 (2)
   🟢 用户A (我)
   🔵 用户B
   ```

5. **测试实时同步**
   - 窗口 A 输入文字
   - 窗口 B 立即看到
   - 左侧用户列表显示 2 个用户

## ✅ 验收标准

### 布局检查

- [ ] 左侧面板宽度 320px
- [ ] 右侧编辑器占据剩余空间（flex: 1）
- [ ] 在线用户显示在左侧面板底部
- [ ] 用户头像、名称、在线指示器正常显示
- [ ] 脉冲动画正常（在线指示器）

### 工具栏检查

- [ ] 选中文字后悬浮工具栏出现
- [ ] 顶部边缘：工具栏完整显示
- [ ] 左侧边缘：工具栏完整显示
- [ ] 右侧边缘：工具栏完整显示
- [ ] 底部边缘：工具栏完整显示
- [ ] 工具栏按钮可点击，功能正常

### 协作功能检查

- [ ] 单用户：显示"正在编辑 (1)"
- [ ] 多用户：显示正确的用户数量
- [ ] 用户加入：立即显示在列表
- [ ] 用户离开：立即从列表移除
- [ ] 当前用户标记"(我)"正确
- [ ] 实时编辑同步正常

### 响应式检查

- [ ] 缩小窗口到移动端尺寸
- [ ] 布局自动垂直堆叠
- [ ] 设置面板宽度变为 100%
- [ ] 编辑器宽度变为 100%

## 🎨 控制台日志检查

打开浏览器控制台（F12），应该看到：

```
✅ 编辑器初始化日志
🔧 [XNote] 使用悬浮工具栏模式
🤝 [XNote] 启用协作模式，文档ID: ...
🔌 [XNote] 连接协作服务器: ws://...
✅ [XNote] 编辑器初始化成功
👥 [XNote] 在线用户更新: 1 [...]
```

## 🐛 常见问题

### 问题 1：工具栏仍然被遮挡

**检查**：

- 确认 `toolbar-type="suspension"` 已设置
- 查看控制台是否有 `🔧 [XNote] 使用悬浮工具栏模式` 日志

### 问题 2：在线用户不显示

**检查**：

- Yjs 服务器是否运行
- 控制台是否有 `👥 [XNote] 在线用户更新` 日志
- `collaboration-enabled="true"` 是否设置

### 问题 3：布局没有变化

**检查**：

- 是否强制刷新（Ctrl + Shift + R）
- 浏览器缓存是否清除

## 📱 移动端测试

1. **按 F12 打开开发者工具**
2. **点击设备工具栏图标**（或 Ctrl + Shift + M）
3. **选择移动设备**（如 iPhone 12）
4. **观察布局**：
   - 设置面板在顶部
   - 编辑器在下方
   - 垂直堆叠，滚动流畅

## 🎉 测试完成！

如果所有检查项都通过，恭喜！新布局已成功实现：

- ✅ 编辑区域更宽敞
- ✅ 工具栏不会被遮挡
- ✅ 在线用户清晰可见
- ✅ 布局更合理直观

---

**需要帮助？** 查看 `布局重构说明.md` 获取详细技术说明。
