# å±€åŸŸç½‘è®¿é—®æŒ‡å—

## ğŸŒ å¦‚ä½•é€šè¿‡å±€åŸŸç½‘è®¿é—®å‰ç«¯

æ ¹æ®ä½ çš„é…ç½®ï¼Œå‰ç«¯å·²ç»æš´éœ²åœ¨å±€åŸŸç½‘ä¸­ï¼Œå…¶ä»–è®¾å¤‡å¯ä»¥ç›´æ¥è®¿é—®ã€‚

---

## ğŸ“ è®¿é—®åœ°å€

å‡è®¾ä½ çš„æœåŠ¡å™¨ IP æ˜¯ `192.168.200.20`

### HTTP è®¿é—®ï¼ˆç«¯å£ 80ï¼‰

```
http://192.168.200.20
```

### HTTPS è®¿é—®ï¼ˆç«¯å£ 443ï¼‰

```
https://192.168.200.20
```

### API æ–‡æ¡£è®¿é—®

```
http://192.168.200.20:8000/docs
```

---

## ğŸ” å¦‚ä½•æŸ¥æ‰¾æœåŠ¡å™¨ IP

### Windows æœåŠ¡å™¨

```cmd
# æ–¹æ³•1: ipconfig
ipconfig

# æŸ¥æ‰¾ "IPv4 åœ°å€" æˆ– "IPv4 Address"
# ä¾‹å¦‚: 192.168.200.20

# æ–¹æ³•2: åªæ˜¾ç¤º IPv4
ipconfig | findstr IPv4
```

### Linux æœåŠ¡å™¨

```bash
# æ–¹æ³•1: ip addr
ip addr show

# æ–¹æ³•2: ifconfig
ifconfig

# æ–¹æ³•3: å¿«é€Ÿè·å–
hostname -I
```

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•

### 1. åœ¨æœåŠ¡å™¨æœ¬åœ°æµ‹è¯•

```bash
# æµ‹è¯• HTTP (ç«¯å£ 80)
curl http://localhost
curl http://127.0.0.1

# æµ‹è¯• HTTPS (ç«¯å£ 443)
curl -k https://localhost

# æµ‹è¯• Backend API
curl http://localhost:8000/docs

# æŸ¥çœ‹ç«¯å£ç›‘å¬çŠ¶æ€
netstat -an | findstr "80 "
netstat -an | findstr "443"
netstat -an | findstr "8000"
```

**Windows PowerShell:**

```powershell
# æµ‹è¯•ç«¯å£
Test-NetConnection -ComputerName localhost -Port 80
Test-NetConnection -ComputerName localhost -Port 443
Test-NetConnection -ComputerName localhost -Port 8000

# æŸ¥çœ‹ç›‘å¬ç«¯å£
netstat -an | Select-String "80 "
netstat -an | Select-String "443"
```

### 2. ä»å±€åŸŸç½‘å…¶ä»–è®¾å¤‡æµ‹è¯•

**æ‰‹æœº/ç”µè„‘æµè§ˆå™¨ï¼š**

```
http://192.168.200.20
```

**å‘½ä»¤è¡Œæµ‹è¯•ï¼š**

```bash
# ä»å…¶ä»–ç”µè„‘æµ‹è¯•è¿æ¥
curl http://192.168.200.20

# æˆ–ä½¿ç”¨ telnet æµ‹è¯•ç«¯å£
telnet 192.168.200.20 80
```

**Windows å‘½ä»¤è¡Œï¼š**

```cmd
curl http://192.168.200.20

REM å¦‚æœæ²¡æœ‰ curlï¼Œä½¿ç”¨ PowerShell
powershell -Command "Invoke-WebRequest -Uri http://192.168.200.20"
```

---

## ğŸ”¥ é˜²ç«å¢™é…ç½®

### Windows é˜²ç«å¢™

#### æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€

```powershell
# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
Get-NetFirewallProfile | Select-Object Name, Enabled

# æŸ¥çœ‹ç«¯å£è§„åˆ™
Get-NetFirewallRule -DisplayName "*80*" | Format-Table -Property DisplayName, Enabled, Direction
```

#### å¼€æ”¾ç«¯å£ï¼ˆå¦‚æœè¢«é˜»æ­¢ï¼‰

```powershell
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShell

# å¼€æ”¾ HTTP (80)
New-NetFirewallRule -DisplayName "HTTP (80)" -Direction Inbound -LocalPort 80 -Protocol TCP -Action Allow

# å¼€æ”¾ HTTPS (443)
New-NetFirewallRule -DisplayName "HTTPS (443)" -Direction Inbound -LocalPort 443 -Protocol TCP -Action Allow

# å¼€æ”¾ Backend API (8000) - å¯é€‰
New-NetFirewallRule -DisplayName "Backend API (8000)" -Direction Inbound -LocalPort 8000 -Protocol TCP -Action Allow
```

#### æˆ–ä½¿ç”¨å›¾å½¢ç•Œé¢

1. æ‰“å¼€ **æ§åˆ¶é¢æ¿** â†’ **Windows Defender é˜²ç«å¢™** â†’ **é«˜çº§è®¾ç½®**
2. ç‚¹å‡»å·¦ä¾§ **å…¥ç«™è§„åˆ™**
3. ç‚¹å‡»å³ä¾§ **æ–°å»ºè§„åˆ™**
4. é€‰æ‹© **ç«¯å£** â†’ **TCP** â†’ è¾“å…¥ `80, 443`
5. é€‰æ‹© **å…è®¸è¿æ¥**
6. åº”ç”¨åˆ°æ‰€æœ‰é…ç½®æ–‡ä»¶
7. å‘½åä¸º "é¡¹ç›®å‰ç«¯è®¿é—®"

### Linux é˜²ç«å¢™ (firewalld)

```bash
# å¼€æ”¾ HTTP
sudo firewall-cmd --permanent --add-service=http

# å¼€æ”¾ HTTPS
sudo firewall-cmd --permanent --add-service=https

# æˆ–ç›´æ¥å¼€æ”¾ç«¯å£
sudo firewall-cmd --permanent --add-port=80/tcp
sudo firewall-cmd --permanent --add-port=443/tcp

# é‡è½½é˜²ç«å¢™
sudo firewall-cmd --reload

# æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£
sudo firewall-cmd --list-all
```

### Linux é˜²ç«å¢™ (ufw)

```bash
# å¼€æ”¾ HTTP
sudo ufw allow 80/tcp

# å¼€æ”¾ HTTPS
sudo ufw allow 443/tcp

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

---

## ğŸ“± å„ç±»è®¾å¤‡è®¿é—®æ–¹å¼

### ç”µè„‘æµè§ˆå™¨

```
ç›´æ¥è®¿é—®: http://192.168.200.20
```

### æ‰‹æœºæµè§ˆå™¨

```
1. ç¡®ä¿æ‰‹æœºè¿æ¥åˆ°åŒä¸€å±€åŸŸç½‘ WiFi
2. æ‰“å¼€æµè§ˆå™¨
3. è¾“å…¥: http://192.168.200.20
```

### å¹³æ¿

```
åŒæ‰‹æœºè®¿é—®æ–¹å¼
```

---

## ğŸ”§ å½“å‰é…ç½®è§£æ

### docker-compose-prod.yml ä¸­çš„ç«¯å£é…ç½®

```yaml
frontend:
  ports:
    - '0.0.0.0:80:80' # âœ… HTTP ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£
    - '0.0.0.0:443:443' # âœ… HTTPS ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£
```

**å«ä¹‰ï¼š**

- `0.0.0.0:80:80`

  - **ç¬¬ä¸€ä¸ª 0.0.0.0** = ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆåŒ…æ‹¬å±€åŸŸç½‘ï¼‰
  - **ç¬¬ä¸€ä¸ª 80** = å®¿ä¸»æœºç«¯å£
  - **ç¬¬äºŒä¸ª 80** = å®¹å™¨å†…ç«¯å£

- å¦‚æœæ”¹ä¸º `127.0.0.1:80:80`ï¼Œåˆ™åªèƒ½æœ¬æœºè®¿é—®ï¼Œå±€åŸŸç½‘æ— æ³•è®¿é—® âŒ

---

## ğŸŒ è®¿é—®æµç¨‹å›¾

```
å±€åŸŸç½‘è®¾å¤‡ (192.168.200.10)
    â†“
é€šè¿‡å±€åŸŸç½‘
    â†“
æœåŠ¡å™¨ IP (192.168.200.20:80)
    â†“
Docker ç«¯å£æ˜ å°„ (0.0.0.0:80 â†’ container:80)
    â†“
Nginx å®¹å™¨ (pm-frontend)
    â†“
åå‘ä»£ç†åˆ° Backend API
    â†“
Backend å®¹å™¨ (pm-backend:8000)
```

---

## â“ å¸¸è§é—®é¢˜æ’æŸ¥

### Q1: æ— æ³•è®¿é—®ï¼Ÿ

**æ’æŸ¥æ­¥éª¤ï¼š**

1. **æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨**

   ```bash
   docker-compose -f docker-compose-prod.yml ps
   ```

   ç¡®ä¿æ‰€æœ‰æœåŠ¡çŠ¶æ€ä¸º `Up`

2. **æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬**

   ```bash
   # Windows
   netstat -an | findstr "80 "

   # Linux
   netstat -tuln | grep :80
   ```

   åº”è¯¥çœ‹åˆ° `0.0.0.0:80` æˆ– `:::80` åœ¨ç›‘å¬

3. **æ£€æŸ¥é˜²ç«å¢™**

   - Windows: è¿è¡Œä¸Šé¢çš„ PowerShell å‘½ä»¤å¼€æ”¾ç«¯å£
   - Linux: è¿è¡Œ firewalld æˆ– ufw å‘½ä»¤

4. **æµ‹è¯•æœ¬åœ°è®¿é—®**

   ```bash
   curl http://localhost
   ```

   å¦‚æœæœ¬åœ°å¯ä»¥è®¿é—®ä½†å±€åŸŸç½‘ä¸è¡Œï¼Œ99% æ˜¯é˜²ç«å¢™é—®é¢˜

5. **æ£€æŸ¥å±€åŸŸç½‘è¿æ¥**

   ```bash
   # ä»å…¶ä»–è®¾å¤‡ ping æœåŠ¡å™¨
   ping 192.168.200.20
   ```

6. **æ£€æŸ¥ Docker æ—¥å¿—**
   ```bash
   docker-compose -f docker-compose-prod.yml logs frontend
   docker-compose -f docker-compose-prod.yml logs backend
   ```

### Q2: è®¿é—®æç¤º CORS é”™è¯¯ï¼Ÿ

**åŸå› ï¼š** Backend çš„ `ALLOWED_ORIGINS` æœªåŒ…å«ä½ çš„è®¿é—®åœ°å€

**è§£å†³ï¼š** ä¿®æ”¹ `docker-compose-prod.yml`

```yaml
backend:
  environment:
    ALLOWED_ORIGINS: '["http://192.168.200.20","http://192.168.200.20:8000","https://192.168.200.20"]'
```

ç„¶åé‡å¯æœåŠ¡ï¼š

```bash
docker-compose -f docker-compose-prod.yml restart backend
```

### Q3: HTTPS æç¤ºè¯ä¹¦ä¸å®‰å…¨ï¼Ÿ

**åŸå› ï¼š** ä½¿ç”¨è‡ªç­¾åè¯ä¹¦æˆ–å†…ç½‘ IP

**è§£å†³æ–¹æ¡ˆï¼š**

**æ–¹æ¡ˆ1: ä¸´æ—¶ä¿¡ä»»è¯ä¹¦ï¼ˆå¼€å‘/æµ‹è¯•ï¼‰**

- Chrome: ç‚¹å‡» "é«˜çº§" â†’ "ç»§ç»­è®¿é—®"
- Firefox: ç‚¹å‡» "é«˜çº§" â†’ "æ¥å—é£é™©å¹¶ç»§ç»­"

**æ–¹æ¡ˆ2: ä½¿ç”¨å†…ç½‘åŸŸåï¼ˆæ¨èï¼‰**

1. é…ç½®å†…ç½‘ DNS æˆ–ä¿®æ”¹ hosts æ–‡ä»¶
2. ä¸ºåŸŸåç”Ÿæˆè¯ä¹¦

**æ–¹æ¡ˆ3: åªä½¿ç”¨ HTTP**

```
http://192.168.200.20
```

### Q4: æ‰‹æœºæ— æ³•è®¿é—®ï¼Ÿ

**æ£€æŸ¥ï¼š**

1. æ‰‹æœºå’ŒæœåŠ¡å™¨åœ¨åŒä¸€å±€åŸŸç½‘å—ï¼Ÿ

   ```
   æ‰‹æœºæŸ¥çœ‹ WiFi è®¾ç½® â†’ IP åœ°å€
   åº”è¯¥å’ŒæœåŠ¡å™¨åœ¨åŒä¸€ç½‘æ®µï¼ˆå¦‚ 192.168.200.xï¼‰
   ```

2. æ˜¯å¦å…³é—­äº†ç§»åŠ¨æ•°æ®ï¼Ÿ

   - ç¡®ä¿ä½¿ç”¨ WiFi è€Œä¸æ˜¯ 4G/5G

3. æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ï¼Ÿ
   - å‚è€ƒä¸Šé¢çš„é˜²ç«å¢™é…ç½®

---

## ğŸ¯ æ¨èé…ç½®ï¼ˆå®‰å…¨æ€§è€ƒè™‘ï¼‰

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

```yaml
# ä»…æš´éœ²å¿…è¦ç«¯å£ç»™å±€åŸŸç½‘
frontend:
  ports:
    - '0.0.0.0:80:80' # âœ… å…¬å¼€ HTTP
    - '0.0.0.0:443:443' # âœ… å…¬å¼€ HTTPS

backend:
  ports:
    - '127.0.0.1:8000:8000' # âš ï¸ ä»…æœ¬æœºè®¿é—®ï¼ˆé€šè¿‡ Nginx åå‘ä»£ç†ï¼‰

postgres:
  ports:
    - '127.0.0.1:5432:5432' # âš ï¸ ä»…æœ¬æœºè®¿é—®ï¼ˆé¿å…æ•°æ®åº“ç›´æ¥æš´éœ²ï¼‰

redis:
  # ä¸æš´éœ²ç«¯å£åˆ°å®¿ä¸»æœºï¼ˆä»…å®¹å™¨é—´è®¿é—®ï¼‰

minio:
  ports:
    - '127.0.0.1:9000:9000' # âš ï¸ ä»…æœ¬æœºè®¿é—®
    - '127.0.0.1:9001:9001' # âš ï¸ ä»…æœ¬æœºè®¿é—®
```

**è¯´æ˜ï¼š**

- `0.0.0.0` = å…è®¸å±€åŸŸç½‘è®¿é—®
- `127.0.0.1` = ä»…å…è®¸æœ¬æœºè®¿é—®
- ä¸å†™ `ports` = ä»…å®¹å™¨é—´è®¿é—®ï¼ˆæœ€å®‰å…¨ï¼‰

---

## ğŸ“ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

### ä¸€é”®æµ‹è¯•è„šæœ¬ (Windows)

```batch
@echo off
echo ====================================
echo å±€åŸŸç½‘è®¿é—®æµ‹è¯•
echo ====================================
echo.

echo 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€...
docker ps | findstr "pm-"
echo.

echo 2. æ£€æŸ¥ç«¯å£ç›‘å¬...
netstat -an | findstr "80 " | findstr "LISTENING"
netstat -an | findstr "443 " | findstr "LISTENING"
echo.

echo 3. æµ‹è¯•æœ¬åœ°è®¿é—®...
curl -s -o nul -w "HTTP è®¿é—®: %%{http_code}\n" http://localhost
curl -s -o nul -w "Backend API: %%{http_code}\n" http://localhost:8000/docs
echo.

echo 4. è·å–æœ¬æœº IP...
ipconfig | findstr "IPv4"
echo.

echo ====================================
echo è¯·ä»å…¶ä»–è®¾å¤‡è®¿é—®ä¸Šé¢æ˜¾ç¤ºçš„ IP åœ°å€
echo ä¾‹å¦‚: http://192.168.200.20
echo ====================================
pause
```

ä¿å­˜ä¸º `test-lan-access.bat`ï¼ŒåŒå‡»è¿è¡Œã€‚

---

## ğŸ“‹ æ€»ç»“

### ä½ çš„è®¿é—®åœ°å€ï¼ˆå‡è®¾æœåŠ¡å™¨ IP ä¸º 192.168.200.20ï¼‰

| æœåŠ¡             | å±€åŸŸç½‘è®¿é—®åœ°å€                    | è¯´æ˜              |
| ---------------- | --------------------------------- | ----------------- |
| **å‰ç«¯**         | `http://192.168.200.20`           | âœ… ä¸»è¦è®¿é—®åœ°å€   |
| **å‰ç«¯ HTTPS**   | `https://192.168.200.20`          | âœ… å¦‚æœé…ç½®äº† SSL |
| **API æ–‡æ¡£**     | `http://192.168.200.20:8000/docs` | âš ï¸ å»ºè®®å†…ç½‘æµ‹è¯•ç”¨ |
| **MinIO æ§åˆ¶å°** | `http://192.168.200.20:9001`      | âš ï¸ å»ºè®®å†…ç½‘ç®¡ç†ç”¨ |

### å…³é”®æ£€æŸ¥ç‚¹

- âœ… æœåŠ¡å·²å¯åŠ¨ï¼ˆ`docker-compose ps`ï¼‰
- âœ… ç«¯å£å·²ç›‘å¬ï¼ˆ`netstat -an | findstr 80`ï¼‰
- âœ… é˜²ç«å¢™å·²å¼€æ”¾ 80 å’Œ 443 ç«¯å£
- âœ… å±€åŸŸç½‘è¿æ¥æ­£å¸¸ï¼ˆ`ping 192.168.200.20`ï¼‰

---

**å¼€å§‹ä½¿ç”¨ï¼ä»å±€åŸŸç½‘ä»»æ„è®¾å¤‡è®¿é—®ï¼š`http://192.168.200.20`** ğŸ‰
