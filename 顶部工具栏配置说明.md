# 顶部固定工具栏配置说明

## ✅ 已完成的修改

### 1. 添加顶部工具栏容器

**文件：** `src/components/core/forms/art-textbus-editor/index.vue`

#### 模板结构

```vue
<template>
  <div class="xnote-editor-wrapper">
    <!-- 顶部工具栏容器（仅在 static 模式显示） -->
    <div ref="toolbarRef" class="xnote-toolbar-host" v-if="toolbarType === 'static'"></div>

    <!-- 编辑器容器 -->
    <div ref="editorRef" class="xnote-editor"></div>
  </div>
</template>
```

#### 样式设计

```scss
.xnote-editor-wrapper {
  display: flex;
  flex-direction: column; /* 垂直布局 */
}

.xnote-toolbar-host {
  flex-shrink: 0; /* 不压缩 */
  border-bottom: 1px solid #e5e7eb;
  background: #f9fafb;
  border-radius: 8px 8px 0 0;
  padding: 8px;
  overflow-x: auto; /* 水平滚动 */
}

.xnote-editor {
  flex: 1; /* 占据剩余空间 */
  overflow: auto; /* 内容滚动 */
}
```

### 2. 配置 StaticToolbarPlugin

**关键代码：**

```typescript
// 配置工具栏
if (props.toolbarType === 'static' && toolbarRef.value) {
  // 顶部固定工具栏
  editorConfig.plugins = [
    new StaticToolbarPlugin({
      host: toolbarRef.value, // 传入工具栏容器
      theme: 'light' // 亮色主题
    })
  ]
  console.log('🔧 [XNote] 使用顶部固定工具栏')
} else {
  // 使用默认工具栏（左侧 + 内联）
  console.log('🔧 [XNote] 使用默认工具栏（左侧 + 内联）')
}
```

### 3. 更新页面配置

#### 创建文档页面

**文件：** `src/views/collaboration/create/index.vue`

```vue
<ArtTextbusEditor
  toolbar-type="static"  <!-- ✅ 使用顶部固定工具栏 -->
  :collaboration-enabled="true"
  ...
/>
```

#### 团队协作页面

**文件：** `src/views/collaboration/document.vue`

```vue
<ArtTextbusEditor
  toolbar-type="static"  <!-- ✅ 使用顶部固定工具栏 -->
  ...
/>
```

---

## 🎨 布局效果

### 顶部固定工具栏模式

```
┌─────────────────────────────────────────────────┐
│ 🔧 顶部工具栏（固定）                           │
│ ┌─────────────────────────────────────────────┐ │
│ │ B I U | 🎨 📎 🔗 | H1 H2 | • 1. | ↶ ↷│ │
│ └─────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│                                                 │
│  编辑器内容区域                                  │
│  可以正常滚动                                    │
│                                                 │
│  ✅ 工具栏始终可见                               │
│  ✅ 工具栏不会被遮挡                             │
│  ✅ 工具栏不会影响滚动                           │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 默认工具栏模式（对比）

```
┌─────────────────────────────────────────────────┐
│ 🔧 左侧工具栏                                    │
│ │                                                │
│ ├─ B I U                                        │
│ ├─ H1 H2                                        │
│ ├─ • 1.                                         │
│ ...                                             │
│                                                 │
│  编辑器内容区域                                  │
│                                                 │
│  选中文字时显示内联工具栏：                       │
│  ┌──────────────┐                               │
│  │ B I U 🎨 📎 │ ← 浮动工具栏                   │
│  └──────────────┘                               │
└─────────────────────────────────────────────────┘
```

---

## 🔧 工具栏类型对比

| 特性         | `static`（顶部固定）  | `default`（默认）  |
| ------------ | --------------------- | ------------------ |
| **位置**     | 编辑器顶部            | 左侧 + 内联        |
| **可见性**   | 始终可见              | 左侧固定，内联浮动 |
| **空间占用** | 占据顶部高度          | 占据左侧宽度       |
| **滚动行为** | 不滚动（固定）        | 内容区滚动         |
| **工具访问** | 始终可访问            | 需要滚动或选中文字 |
| **适用场景** | 需要频繁使用工具      | 更大的编辑空间     |
| **用户习惯** | 类似 Word/Google Docs | 类似富文本编辑器   |

---

## 🚀 测试步骤

### 步骤 1：刷新页面

```bash
# 强制刷新（清除缓存）
Ctrl + Shift + R (Windows/Linux)
Cmd + Shift + R (Mac)
```

### 步骤 2：观察控制台日志

应该看到：

```
🔧 [XNote] 使用顶部固定工具栏
✅ [XNote] 编辑器初始化成功
```

### 步骤 3：检查页面布局

#### ✅ 应该看到：

1. **顶部工具栏**

   - 位于编辑器最上方
   - 灰色背景（#f9fafb）
   - 包含所有编辑工具按钮

2. **编辑器区域**

   - 在工具栏下方
   - 占据剩余空间
   - 可以正常滚动

3. **工具栏功能**
   - 所有按钮可点击
   - 悬停有高亮效果
   - 工具栏不滚动（固定）

#### ❌ 不应该出现：

- 左侧垂直工具栏
- 选中文字后的浮动工具栏
- 工具栏被遮挡
- 堆栈溢出错误

### 步骤 4：测试功能

1. **点击编辑器** → 应该出现光标
2. **输入文字** → 应该正常显示
3. **选中文字** → 不应该出现浮动工具栏
4. **点击工具栏按钮** → 应该正常工作（如加粗、斜体）
5. **输入大量内容** → 编辑器应该滚动，工具栏固定

---

## 🐛 问题诊断

### 问题 1：工具栏不显示

**检查：**

```javascript
console.log(toolbarRef.value) // 应该是 HTMLElement
console.log(props.toolbarType) // 应该是 "static"
```

**可能原因：**

- `v-if="toolbarType === 'static'"` 条件不满足
- `toolbarRef` 未正确引用

### 问题 2：堆栈溢出仍然发生

```
Uncaught RangeError: Maximum call stack size exceeded
```

**说明：**

- 这不是工具栏配置的问题
- 可能是 XNote 与您的环境不兼容
- 建议检查 XNote 版本：`npm list @textbus/xnote`

**临时解决方案：** 如果问题持续，建议更换编辑器：

- [Quill](https://quilljs.com) - 稳定可靠
- [TipTap](https://tiptap.dev) - 现代化，支持协作
- [Slate](https://docs.slatejs.org) - 高度可定制

### 问题 3：编辑器高度异常

**检查样式：**

```scss
.xnote-editor-wrapper {
  height: v-bind(height); // 应该有值
  display: flex;
  flex-direction: column;
}
```

**可能原因：**

- `height` prop 未传入
- Flex 布局配置错误

---

## 📊 当前配置状态

### 创建文档页面

- ✅ 使用顶部固定工具栏
- ✅ 启用协作功能
- ✅ 左侧显示在线用户

### 团队协作页面

- ✅ 使用顶部固定工具栏
- ⚠️ 协作功能待配置

### 编辑器组件

- ✅ 支持 3 种工具栏类型
- ✅ 动态配置插件
- ✅ 样式完整

---

## 📚 相关代码

### Props 定义

```typescript
interface Props {
  toolbarType?: 'default' | 'suspension' | 'static'
}

const props = withDefaults(defineProps<Props>(), {
  toolbarType: 'default'
})
```

### 工具栏配置逻辑

```typescript
if (props.toolbarType === 'static' && toolbarRef.value) {
  // 顶部固定工具栏
  editorConfig.plugins = [
    new StaticToolbarPlugin({
      host: toolbarRef.value,
      theme: 'light'
    })
  ]
} else {
  // 默认工具栏（XNote 自动配置）
}
```

### 样式关键点

```scss
.xnote-toolbar-host {
  flex-shrink: 0; // 不压缩
  border-bottom: 1px solid; // 底部边框
  background: #f9fafb; // 浅灰背景
  overflow-x: auto; // 水平滚动
}

.xnote-editor {
  flex: 1; // 占满剩余空间
  overflow: auto; // 内容滚动
}
```

---

## ✅ 验收标准

### 必须满足

- [ ] 工具栏显示在编辑器顶部
- [ ] 工具栏背景为浅灰色
- [ ] 工具栏不会滚动（固定）
- [ ] 编辑器内容可以滚动
- [ ] 所有工具按钮可用
- [ ] 没有左侧垂直工具栏
- [ ] 没有浮动内联工具栏

### 可选优化

- [ ] 工具栏按钮悬停效果
- [ ] 工具栏响应式布局
- [ ] 工具栏自定义配置
- [ ] 工具栏主题切换

---

## 💬 用户反馈

**请测试后告诉我：**

1. **工具栏是否在顶部？** ✅ / ❌
2. **工具栏是否固定（不滚动）？** ✅ / ❌
3. **编辑器内容可以滚动吗？** ✅ / ❌
4. **还有堆栈溢出错误吗？** ✅ / ❌
5. **所有工具按钮都能用吗？** ✅ / ❌

根据您的反馈，我会进一步优化或修复问题。

---

**更新时间**: 2025-11-11  
**配置状态**: ✅ 已完成  
**测试状态**: ⏳ 待用户验证
